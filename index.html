
<!DOCTYPE html><html>
<head>
    <meta charset="UTF-8" />
    <link rel="icon" href="./html/images/favicon.ico" type="image/x-icon" />
    <style>
        /* === Global styles === */
        body {
          margin: 0;
          padding: 0;
          background-color: #000;
          display: flex;
          flex-direction: row;
          justify-content: flex-start;
          align-items: flex-start;
          font-family: Arial, sans-serif;
          gap: 10px;
          flex-wrap: wrap;
        }

        @font-face {
          font-family: 'RDOFont';
          src: url('./Fonts/RDO_chinese_rocks_rg.otf') format('opentype');
          font-weight: normal;
          font-style: normal;
        }
        @font-face {
          font-family: 'hapna';
          src: url('./Fonts/hapna.woff2') format('woff2');
          font-weight: normal;
          font-style: normal;
        }

        /* === Layout containers === */
        .page-container {
          display: flex;
          flex-direction: column;
          min-height: 100vh;
        }
        .main-container {
          display: flex;
          flex-wrap: wrap;
          justify-content: flex-start;
          align-items: flex-start;
          gap: 10px;
          margin: 0;
          padding: 0;
        }

        .left-column {
          display: flex;
          flex-direction: column;
          max-width: 850px;
          width: 100%;
        }

        .sidebar-container {
          display: block;
          width: 450px;
          background-color: #111;
          color: #eee;
          /*border: 2px solid orange;*/
          padding: 15px;
          box-sizing: border-box;
          font-family: Arial, sans-serif;
          overflow: visible; /* allow images to stick outside */
          /* margin-left: -10px;shift left */
        }
        
        
        /* COLUMN 3: BONUS INFO - Fixed to 250px wide */
        .bonus-container {
            padding: 7px;
            background-color: #111; /*Dark grey background*/
            display: flex;
            flex-direction: column;
            /* --- FIXED WIDTH CHANGES --- */
            width: 250px; 
            min-width: 250px; 
            max-width: 850px;
            /*flex-shrink: 0; Ensures this column does not shrink, prioritizing the fixed width */
            /* --------------------------- */
        }
        

        .stats-heading {
            font-family: 'RDOFont', sans-serif;
            font-size: 1.3rem;
            margin-top: 0;
            margin-bottom: 5px;
            border-bottom: 2px solid #555;
            padding-bottom: 5px;
            color: #666666; /* PRESERVED: Keeping the original color */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            
        }
        
        .stats-text {
            font-family: 'hapna', sans-serif; /* Example font */
            font-size: .9rem;
            color: #aaa;
            white-space: pre-wrap; /* allows \n line breaks in descriptions */
            letter-spacing: -0.05em; 
            margin-top: 0;
            margin: 0;
        }

        /* *** FIX: Styling for non-shifting streak adjustment controls *** */
        #streak-controls {
            opacity: 0;
            visibility: hidden;
            color: #999;
            cursor: pointer;
            user-select: none;
            font-size: 0.8rem;
            margin-left: 10px;
            transition: opacity 0.2s ease-in-out, visibility 0.2s ease-in-out;
        }
        #streak-container:hover #streak-controls {
            opacity: 1;
            visibility: visible;
        }
        #streak-up, #streak-down {
            padding: 0 4px;
        }
        #streak-up:hover, #streak-down:hover {
            color: #fff;
        }
        
     
        
        
        /* Ensure the animation class uses the 1000ms duration */
        .gold-exciting-flash {
            animation: simpleGoldGlow 1000ms ease-out forwards;
        }

        /* Define the simple glow keyframes */
        /* Ensure the animation class uses the 1ms duration for an instant state change */
        .gold-exciting-flash {
            animation: instantWhiteGlow 1ms forwards;
        }

        @keyframes instantWhiteGlow {
            /* 0% Start: Text and glow go instantly white */
            0% {
                color: white !important; 
                text-shadow: 
                    0 0 2px white,
                    0 0 4px #eeeeee; /* Strong white/silver glow */
                opacity: 1;
            }
            
            /* 100% End: We keep it at the flash state so the JavaScript timeout controls the duration */
            100% {
                color: white !important;
                text-shadow: 
                    0 0 3px white,
                    0 0 6px #eeeeee;
                opacity: 1;
            }
        }
        
        /* Set the animation class to use the correct keyframes and the JS duration */
        .gold-exciting-flash {
            /* The 1000ms duration is crucial, matching your JavaScript setTimeout */
            animation: instantWhiteGlow 1000ms forwards;
        }

            


        .banner-container {
          position: sticky;
          top: 0;
          z-index: 10; /* stays above other content */
          
          
          width: 100%;
          max-width: 850px;
          min-width: 400px;
          background-color: #000;
          /*border: 2px solid blue;*/
          box-sizing: border-box;
          padding: 10px;
          color: #eee;
        }

        .banner-image-wrapper {
          position: relative;
          width: 100%;
        }

        .banner-image {
          width: 100%;
          height: auto;
          display: block;
        }

        .banner-text-overlay {
          position: absolute;
          top: -3%;
          left: 50%;
          transform: translateX(-50%);
          color: white;
          text-align: center;
          width: 90%;
          text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
          pointer-events: none;
          font-family: 'RDOFont', sans-serif;
        }

        .banner-title {
          font-size: 2.5rem;
          margin: 10px 0;
          text-shadow:
            -2px -2px 0 #000,
             2px -2px 0 #000,
            -2px  2px 0 #000,
             2px  2px 0 #000;
        }

        .banner-date {
          font-size: 1.4rem;
          margin-bottom: 10px;
          margin-top: -15px;
          text-shadow:
           -1px -1px 2px #000,
            1px -1px 2px #000,
           -1px  1px 2px #000,
            1px  1px 2px #000;
        }

        .challenge-counters {
          position: absolute;
          bottom: 10px;
          left: 0;
          right: 0;
          display: flex;
          justify-content: space-between;
          padding: 0 15px;
          font-size: 1.25rem;
          color: white;
          text-shadow: 3px 3px 2px rgba(0,0,0,0.6);
          pointer-events: none;
          font-family: 'RDOFont', sans-serif;
          transform: scaleY(1.15); /* Increase font height */
          
        }

        .challenge-counters > div {
          white-space: nowrap;
        }

        .challenge-counters span {
          display: inline-block;
          width: 4ch;
          text-align: right;
        }
        
        .counter-glow {
          color: white;
          text-shadow:
            0 0 5px rgba(255, 255, 160, 0.75),  /* yellow glow with an opacity (0.75) */
            0 0 10px rgba(255, 255, 160, 0.75),
            0 0 15px rgba(255, 255, 160, 0.75);
          transition: text-shadow 0.3s ease;
        }
        
        @keyframes counterPop {
          0% {
            transform: scale(1);
          }
          50% {
            transform: scale(1.3);
          }
          100% {
            transform: scale(1);
          }
        }

        .counter-pop {
          animation: counterPop 0.4s ease forwards;
        }
        
        

        .general-challenges-container {
          width: 100%;
          max-width: 850px;
          margin: 0 auto;
          background-color: #111;
          padding: 15px;
          box-sizing: border-box;
          color: white;
          font-family: 'hapna', sans-serif;
          font-size: 1.25rem;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
          /*border: 2px solid green;*/
        }



/* ############################################################# */
/*  Role challenges switching logic as browser viewport narrows  */
/* ############################################################# */
        
        /* NEW: Rule to hide the bonus container when screen is 1600px or less (The Requirement) */
        @media (max-width: 1600px) {
            .bonus-container {
                display: none; 
          }
        }
        
        
        
        /* Narrow screens: column layout, sidebar below main */
        @media (max-width: 1320px) {
          body {
            flex-direction: column;
            align-items: center;
          }
          
            .main-container {
            flex-direction: column;
            align-items: center;
            width: 100%;    /* allow children to fill horizontally */
            align-items: stretch; /* <— THIS is the key */
            min-width: 420px;
          }
          
          .sidebar-container {
            width: 100% !important; 
            max-width: 850px !important;
            margin-left: 0;    /* center below main container */
          }      
        }

        /* === Challenge checkboxes with wrapped text aligned properly === */
        .challenge label {
          display: flex; /* container */
          align-items: flex-start;  /* Align to the top of the checkbox */
          gap: 8px;                 /* Space between checkbox and text */
          position: relative; /* for absolute checkbox */
          padding-left: 0px; /* reserve space for checkbox */
          cursor: pointer;
          white-space: normal;
          line-height: 1.3;
        }
        
        .challenge:first-of-type label {
          margin-top: -8px; /* adjust as needed */
        }

        /* Position the checkbox at the left of label */
        .challenge-checkbox {
          width: 14px;
          height: 14px;
          margin: 0;
          margin-top: 6px;  /* Optional: better vertical alignment */
          appearance: none; /* Remove default styling */
          -webkit-appearance: none;
          background-color: #888; /* Default background */
          /* background-color: orange; /* TEST */*/
          border: 2px solid #333;
          border-radius: 3px;
          cursor: pointer;
        }
        
        .challenge-checkbox:checked {
          background-color: #222;
          background-color: #b00000;  /* Dark Red Colour */
          border: 2px solid #333;
          border-radius: 3px;
        }
        
        /* add a checkmark */
        .challenge-checkbox:checked::before {
          content: "✔";
          display: block;
          text-align: top;
          color: white;
          font-size: 12px;
          line-height: 10px;
        }
        

        /* Text span with hanging indent:
           first line starts after checkbox,
           wrapped lines align under text, NOT under checkbox */
           
        .challenge-text {
          display: block;
          display: block;
          word-wrap: break-word;
          max-width: 100%;
          user-select: none;
        }


        /* Optional: styling for challenge description */
        .challenge-desc {
          margin-left: 22px; /* indent to align with text */
          font-size: 1rem;
          color: #999999;
          padding-bottom: 7px;
          white-space: pre-wrap;  /* Preserve \n line breaks and wrap long lines */
          line-height: 1.2;  /* smaller numbers = tighter spacing */
        }
        
        .thin-divider {
          border: none;
          border-top: 1px solid #444;
          /*width: 825px;    Allowing this will kill the word-wrap and dynamic resizing of the general challenges*/
          max-width: 100%;
          margin: 8px auto;
        }


    
        .role-heading {
            font-family: 'RDOFont', sans-serif;  /* Example font, change as needed */
            font-size: 1.5rem;
            color: #eee;
            margin: -4px 0 0 0;
            
            text-shadow:
            -3px -3px 0 #000,  
             3px -3px 0 #000,
            -3px 3px 0 #000,
             3px 3px 0 #000;
             text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
            letter-spacing: 0.05em; /* Adjust this value to your liking */
            padding-left: 20px; /* Increase this to move the text right */
            background-color: transparent;
            overflow: visible;
            /*Adding picture behind the heading text*/
            z-index: 0; /* Create a stacking context */
            background-image: url('HTML/images/RDO_Role_Challenges_Header3.png');
            background-repeat: no-repeat;
            background-position: 2px center;
            background-size: 410px 35px;
            
            display: flex;
            justify-content: space-between;
            align-items: center;
    
        }
            /* Space between different role challenges */
            .role-challenge {
              margin-bottom: .6rem; /* adjust as needed */
              margin-top: -1px;     /* <--- THIS LINE to pull it up */
            }

        .role-challenge-text {
            font-family: 'hapna', sans-serif; /* Example font */
            font-size: 1.05rem;
            color: #eee;
            display: inline-block; /* keeps it inline for natural text flow */
            line-height: 1.1;
            display: inline;
            transform: scaleY(1.1); /* Increase font height */


        }
        .role-challenge-desc {
            font-family: 'hapna', sans-serif; /* Example font */
            font-size: .95rem;
            color: #aaa;
            margin-left: 6px; /* aligns under the role challenge text */
            white-space: pre-wrap; /* allows \n line breaks in descriptions */
            transform: scaleX(0.925); /* reduce width to 90% */
            line-height: 0.99;  /* <--- ADD THIS LINE (Lower number = tighter gap) */
            margin-top: 1px;   /* <--- OPTIONAL: Pulls description closer to the title */
        }
        
        /*  ##### Role Challenges Tickboxes ##### */
        
        /* Unchecked state */
        .role-challenge input[type="checkbox"] {
            width: 14px;
            height: 14px;
            margin: 0;
            margin-top: 0px;  /* Optional: better vertical alignment */
            appearance: none; /* Remove default styling */
            -webkit-appearance: none;
            background-color: #888; /* Default background */
            border: 2px solid #333;
            border-radius: 3px;
            cursor: pointer;
        }
        
        /* Checked state */
        .role-challenge input[type="checkbox"]:checked {
            background-color: #222;
            background-color: #b00000;  /* Dark Red Colour */
            border: 2px solid #333;
            border-radius: 3px;
        }
        .role-challenge input[type="checkbox"]:checked::before {
            content: "✔";
            display: block;
            text-align: center;
            color: white;
            font-size: 12px;
            line-height: 14px;
            vertical-align: middle;
            position: relative;
            top: -2px; /* Adjust this value to fine-tune the vertical alignment */
        }
        
        
        .role-challenge-label {
          display: flex;
          align-items: baseline; /* aligns checkbox with first line of text */
          gap: 0.5em;               /* space between checkbox and text */
          cursor: pointer;
          user-select: none;
          -webkit-user-select: none; /* Safari */
          -moz-user-select: none; /* Firefox */
          -ms-user-select: none; /* IE/Edge */
          
        }
        
        /* Using this to scale role challenge text */
        .text-scale {
            display: inline-block;
            transform: scaleX(0.9);
            transform-origin: left;
        }
        
        /* Makes it clickable */
        .difficulty-toggle {
            cursor: pointer;
            user-select: none;
            font-size: 0.6em;  /* adjust if needed */
            margin-right: 10px; /* adjust px as you like */
            color: #dd0000;  /* Dark Red Colour */
            transform: scaleY(1.2); 
            /* Mid-grey outline effect */
            text-shadow:
              -1px -1px 0 #111111,
               1px -1px 0 #111111,
              -1px  1px 0 #111111,
               1px  1px 0 #111111;
            }
        
        /* Dimming the difficulty-toggle */
        .dimmed-text {
            opacity: 0.5;
            pointer-events: none;
            user-select: none;
        }


        
        

/* ==== Checkbox Challenge Completion Styling ==== */


        /* When checkbox is checked, style the following sibling text */
        .challenge-checkbox:checked + .challenge-text,
        .challenge-checkbox:checked + .role-challenge-text {
          color: #555;
          text-decoration: line-through;
          opacity: 0.5;
        }


        /* This dims both the challenge text and the description when the challenge is completed */
        .challenge.completed .challenge-text,
        .challenge.completed .challenge-desc,
        .role-challenge.completed .role-challenge-text,
        .role-challenge.completed .role-challenge-desc {
          color: #555 !important;
          /* Uncomment if you want strikethrough and opacity effect */
          text-decoration: line-through;
          opacity: 0.85;
        }
        
        
        .role-completed {
          color: #555;
          font-weight: bold;
        }


        /* Dim role challenges and headings when all 9 role challenges are completed */
        .role-completed .role-challenge-text,
        .role-completed .role-heading {
          opacity: 0.5; /* dim text and headings */
          color: #666;  /* optional dim color */
          transition: opacity 0.3s ease;
          background: orange;
        }

        /* Keep checkboxes fully visible and interactive */
        .role-completed .challenge-checkbox {
          opacity: 1 !important;
          pointer-events: auto;
        }


        .role-challenge-desc.dimmed {
          opacity: 0.5;
          color: #666666;
          transition: opacity 0.3s ease, color 0.3s ease;
        }



/* ==== Global Checkbox Role Challenge Completion Styling (9 out of 9)==== */


        /* Global dimming for all text elements when all roles are complete */
        .all-roles-completed .role-heading,
        .all-roles-completed .role-challenge-label span, /* Targets the Challenge Name */
        .all-roles-completed .role-challenge-desc, /* ✅ NEW: Targets the Description Element */
        .all-roles-completed .role-challenge p /* General Paragraph Fallback */
        {
          color: #888 !important; 
          opacity: 0.5 !important; /* Forces dimming, overriding competing rules */
          transition: color 0.3s, opacity 0.3s;
        }

        /* When 9/9 roles are complete, make the entire DIV of any unticked challenge non-interactive */
        .all-roles-completed .role-challenge:not(.completed) {
            pointer-events: none;
            cursor: default;
        }

        /* Then, specifically dim the checkbox inside that disabled DIV for visual feedback */
        .all-roles-completed .role-challenge:not(.completed) input[type="checkbox"] {
            opacity: 0.35 !important;
        }
        
        
    /*############ RDO-CLOCK SECTION ############*/        
        .rdo-clock {
            position: absolute;
            bottom: 5px;  /* Position near the bottom of the banner */
            left: 47.5%;
            transform: translateX(-50%);
            transform: translateY(-2px);  /* Negative value moves it up */
            font-family: 'RDOFont', sans-serif;
            font-size: calc(1.5vw + 0.8rem);
            color: #white;
            text-shadow:
             -4px -4px 4px #cf0202,
              4px -4px 4px #cf0202,
             -4px  4px 4px #cf0202,
              4px  4px 4px #cf0202;
        }
        
        .rdo-clock.night-glow {
            text-shadow:
            -4px -4px 4px #0d2542,
             4px -4px 4px #0d2542,
            -4px  4px 4px #0d2542,
             4px  4px 4px #0d2542;
            /*color: #white;               Optional: change text color too */
}



    /*############ API CREDIT SECTION ############*/
        .api-credit-separator {
            border: none;
            height: 15px;               /* Thickness of the line */
            background-color: black;
            margin: 10px -15px;         /* Vertical spacing, and negative horizontal to counter the container padding so it stretches all the way across */
        }


        /* API credit styling */
        .api-credit {
          margin-top: auto;
          margin-bottom: 0px;
          padding: 0px 0 0px 5px;
          font-size: 0.75rem;
          color: #5b5b5b;
          font-family: Arial, sans-serif;
          text-align: right;
          line-height: 1
        }
        .api-credit a {
          color: #5b5b5b;
          text-decoration: none;
        }
        .api-credit a:hover {
          text-decoration: underline;
          color: #8e7878;
        }
        
        
     /*############ PAUSE RDR BUTTON SECTION ############*/       
        .pause-rdr2-button {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 9999;
            padding: 6px 10px;
            background-color: #b00000;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            cursor: pointer;
            font-family: 'hapna', sans-serif;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.4);
            transition: background-color 0.3s ease;
        }
        .pause-rdr2-button:hover {
            background-color: #900000;
        }
        
        #pauseBtn {
          position: absolute;
          top: 5px;
          right: 10px;
          width: 100px;
          cursor: pointer;
          display: none;    /* hidden by default */
          filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.6));
        }
        
        #pauseBtn:hover {
          filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
          transform: scale(1.05);
        }

    /*############ GOLD LOG CHART ############*/
        #gold-log-chart-container {
            display: flex;
            justify-content: flex-start; /* Aligns bars to the left */
            align-items: flex-end;
            height: 75px;
            width: 100%;
            background-color: #151515;
            border: 1px solid #000;
            border-radius: 8px;
            padding: 2px;
            box-sizing: border-box;
            gap: 2px;
            overflow: hidden; /* Prevents scrollbar */
        }

        .chart-bar-wrapper {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 100%;
        }

        .chart-bar {
            width: 100%;
            background-color: #B8860B; /* Darker Gold */
            border-radius: 2px 2px 0 0;
            transition: background-color 0.2s ease;
            min-height: 1px;
        }
        
        .chart-bar-wrapper:hover .chart-bar {
            background-color: #FFE957; /* Brighter gold for highlight */
        }
        
        .chart-info-display {
            color: #5b5b5b;
            font-family: 'hapna', sans-serif; /* Use hapna font */
            font-size: 0.8rem;
            text-align: left; /* Justify left */
            padding-left: 5px; /* Add some padding */
            height: 1.2em;
            margin-top: -3px; /* reduce or increase to move graph's 'tooltip' text up or down */
            transition: color 0.2s;
            letter-spacing: -0.05em; /* Add this line for narrower text */
        }
        
        
/* === UPDATED: Tighter Pulse Animation === */
        @keyframes urgentPulse {
            0% { 
                /* Very tight shadow to keep text crisp */
                text-shadow: 0 0 1px #fff; 
                color: #fff;
            }
            50% { 
                /* Reduced blur radius (5px/8px instead of 15px/25px) */
                text-shadow: 0 0 5px #fff, 0 0 8px #FFD700; 
                color: #fffae6;
            }
            100% { 
                text-shadow: 0 0 1px #fff; 
                color: #fff;
            }
        }

        .active-event-glow {
            animation: urgentPulse 1.5s infinite ease-in-out;
        }
        
        
        
        
    </style>
</head>
<body>
    <div class="main-container">
        <div class="left-column">
            <div class="banner-container">
                <div class="banner-image-wrapper">
                    <img src="HTML/images/RDO_Banner_Wide.jpg" alt="Banner" class="banner-image"/>
                    <img id="pauseBtn" src="HTML/images/RDO_PauseStopwatch.png" alt="Pause RDO" title="Pause RDO"
                         style="position:absolute; top:0px; left:10px; width:50px; cursor:pointer;" />                    
                    <div class="banner-text-overlay">
                        <h1 class="banner-title">Daily Challenges</h1>
                        <div class="banner-date">Friday, 2nd January 2026</div>
                    </div>
                    <div class="challenge-counters">
                        <div>General Challenges <span id="general-counter">(0/7)</span></div>
                        <div>Role Challenges <span id="role-counter">(0/9)</span></div>
                    </div>
                    <div class="rdo-clock" id="rdo-clock">
                        --:--
                    </div>
                </div>
            </div>

            <div class="general-challenges-container">
                
        <div class="challenge" data-difficulty="None">
          <label>
            <input type="checkbox" class="challenge-checkbox" id="challenge_2026-01-02_1fd0b1ebefca46d9" />
            <span class="challenge-text">1 Camp themes updated</span>
          </label></div>
<hr class="thin-divider">

        <div class="challenge" data-difficulty="None">
          <label>
            <input type="checkbox" class="challenge-checkbox" id="challenge_2026-01-02_b303e08b0765a3cf" />
            <span class="challenge-text">5280 Distance traveled by wagon with a Posse Member</span>
          </label></div>
<hr class="thin-divider">

        <div class="challenge" data-difficulty="None">
          <label>
            <input type="checkbox" class="challenge-checkbox" id="challenge_2026-01-02_a6c27210a1faa413" />
            <span class="challenge-text">3 Elk skinned</span>
          </label>
          <div class="challenge-desc">Set your camp in Big Valley and you'll soon find elk grazing by the winding river.
Tall Trees, north of Manzanita Post is another decent area. [#1]</div></div>
<hr class="thin-divider">

        <div class="challenge" data-difficulty="None">
          <label>
            <input type="checkbox" class="challenge-checkbox" id="challenge_2026-01-02_5809422c650d5dcb" />
            <span class="challenge-text">3 Player kills from cover in Showdowns</span>
          </label></div>
<hr class="thin-divider">

        <div class="challenge" data-difficulty="None">
          <label>
            <input type="checkbox" class="challenge-checkbox" id="challenge_2026-01-02_57ac318e0bf1efb2" />
            <span class="challenge-text">10 Player kills in Showdowns</span>
          </label>
          <div class="challenge-desc">Featured series does count if you start in the lobby, but usually free aim so harder. [#1]</div></div>
<hr class="thin-divider">

        <div class="challenge" data-difficulty="None">
          <label>
            <input type="checkbox" class="challenge-checkbox" id="challenge_2026-01-02_cbccf8b0caa0c117" />
            <span class="challenge-text">Visited a shop in Blackwater</span>
          </label></div>
<hr class="thin-divider">

        <div class="challenge" data-difficulty="None">
          <label>
            <input type="checkbox" class="challenge-checkbox" id="challenge_2026-01-02_57ebb38d55264689" />
            <span class="challenge-text">1 Waves completed in Call to Arms</span>
          </label></div>

            </div>
        </div>

<!-- COLUMN 2: ROLE CHALLENGES -->
        <div class="sidebar-container" id="roles-container">
            <div class="role-container">
  <h3 class="role-heading" id="role-bounty-hunter">Bounty Hunter&nbsp; <span class="difficulty-toggle RDOFont" data-difficulty="hard">(Hard: Rank 15+)</span></h3>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_7c140dc80ee8b55b" />
            <span class="role-challenge-text">1 Bounty targets hogtied with a Reinforced Lasso</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_6a76260d214c5a5c" />
            <span class="role-challenge-text">1 Bounty targets looted</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_54e09aee142745a5" />
            <span class="role-challenge-text">1 Eagle Eye used to track a bounty target</span>
          </label>
          <div class="role-challenge-desc">Can shoot with tracking arrow and then track them [#1]</div></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_415cc79724ecf9a3" />
            <span class="role-challenge-text">2 Bounties brought in from West Elizabeth posters</span>
          </label>
          <div class="role-challenge-desc">Strawberry, Blackwater, Wallace Station, & Riggs Station [#1]</div></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_16775e1c2359a314" />
            <span class="role-challenge-text">1 Bounty targets tagged with Tracking Arrow</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_ca1fa9508588e161" />
            <span class="role-challenge-text">1 Bounty targets taken down with Bolas</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_edd0762d5fecf97f" />
            <span class="role-challenge-text">2 Bounties completed within one real-world hour</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_aac61ef1b09f3212" />
            <span class="role-challenge-text">1 Hard ($$$) or Legendary Bounty mission completed</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_4a008830b82fce96" />
            <span class="role-challenge-text">3 More than one bounty target brought in at once</span>
          </label></div>
</div>
<hr class="thin-divider" />
<div class="role-container">
  <h3 class="role-heading" id="role-trader">Trader&nbsp; <span class="difficulty-toggle RDOFont" data-difficulty="hard">(Hard: Rank 15+)</span></h3>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_ad26031174779a0b" />
            <span class="role-challenge-text">5280 Distance Delivery Wagon traveled on mission</span>
          </label>
          <div class="role-challenge-desc">Use a Change Appearance solo lobby so it registers [#1]</div></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_9a129523fe2ccb95" />
            <span class="role-challenge-text">2 Large animal carcasses donated to Cripps</span>
          </label>
          <div class="role-challenge-desc">Deer, Pronghorn, Bighorn Ram, Panther, Cougar, Wolf [#1]</div></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_ca28dcbb25fc64e7" />
            <span class="role-challenge-text">1 Resupply completed with 3 mins left</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_7dd7bfd6fa785588" />
            <span class="role-challenge-text">2 Camp Stews eaten</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_1dff07eb13dbbe2e" />
            <span class="role-challenge-text">5 Medium animal carcasses donated to Cripps</span>
          </label>
          <div class="role-challenge-desc">Emerald Ranch, for sheep, turkeys, & foxes.
Racoons, Geese, Cranes, Herons, & Pelicans [#1]</div></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_6f0533ee87fa7578" />
            <span class="role-challenge-text">$100.00 Money made from trading</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_557dce4124d165b0" />
            <span class="role-challenge-text">15838 Distance Delivery Wagon traveled on mission</span>
          </label>
          <div class="role-challenge-desc">Use a Change Appearance solo lobby so it registers [#1]</div></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_a54ddaa847862b1b" />
            <span class="role-challenge-text">2 Goods sold to distant buyer</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_24c423f98a62e788" />
            <span class="role-challenge-text">10 Small animal carcasses donated to Cripps</span>
          </label></div>
</div>
<hr class="thin-divider" />
<div class="role-container">
  <h3 class="role-heading" id="role-collector">Collector&nbsp; <span class="difficulty-toggle RDOFont" data-difficulty="hard">(Hard: Rank 15+)</span></h3>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_af78eab5de3bd9a2" />
            <span class="role-challenge-text">1 American Wild Flowers found</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_40ee57e3eff733aa" />
            <span class="role-challenge-text">1 Collectibles found with a Shovel</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_0861bf25a71475c5" />
            <span class="role-challenge-text">1 Tarot Cards found</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_2fe014c782337625" />
            <span class="role-challenge-text">2 Antique Alcohol Bottles found</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_a7dbe46321a815cf" />
            <span class="role-challenge-text">3 Bird Eggs found</span>
          </label>
          <div class="role-challenge-desc">Carry 5 duck eggs, and you can then pick another 5 [#3]</div></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_2cbde4a278703e2b" />
            <span class="role-challenge-text">1 Collectibles found with a Metal Detector</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_7412647babd68c64" />
            <span class="role-challenge-text">3 Arrowheads found</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_0d3676a724b3c197" />
            <span class="role-challenge-text">3 Collectibles looted from non-player enemies</span>
          </label>
          <div class="role-challenge-desc">Gold Teeth count for this [#1]</div></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_3fb8f9140c0e4dcd" />
            <span class="role-challenge-text">3 Collectibles sold to Madam Nazar</span>
          </label></div>
</div>
<hr class="thin-divider" />
<div class="role-container">
  <h3 class="role-heading" id="role-moonshiner">Moonshiner&nbsp; <span class="difficulty-toggle RDOFont" data-difficulty="hard">(Hard: Rank 15+)</span></h3>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_119b104a967e8b9d" />
            <span class="role-challenge-text">Completed regular or better moonshine recipe</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_f86d8cb4d98186fd" />
            <span class="role-challenge-text">Drank own weak or higher strength moonshine</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_8f895dc71bc9e233" />
            <span class="role-challenge-text">1 Moonshine Story Mission completed</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_0c3e86f05c02a608" />
            <span class="role-challenge-text">Completed improved or better moonshine recipe</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_2bad69e601ef3fb5" />
            <span class="role-challenge-text">3218 Distance Moonshine Wagon traveled on mission</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_bc42d8f8821a9c52" />
            <span class="role-challenge-text">1 Moonshine Bar - Drunken player interaction</span>
          </label>
          <div class="role-challenge-desc">If solo, use Y then B button combo as entering shack [#1]</div></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_bf63086bf4d7da82" />
            <span class="role-challenge-text">2 Crafted Toxic Moonshine</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_0d7fa226032602eb" />
            <span class="role-challenge-text">4 Moonshine served to other players at a bar</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_81cf0ee7813f2ae3" />
            <span class="role-challenge-text">Moonshine sold with at least 18 bottles intact</span>
          </label></div>
</div>
<hr class="thin-divider" />
<div class="role-container">
  <h3 class="role-heading" id="role-naturalist">Naturalist&nbsp; <span class="difficulty-toggle RDOFont" data-difficulty="hard">(Hard: Rank 15+)</span></h3>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_a04f5ec0bd736c6b" />
            <span class="role-challenge-text">1 Blending Tonics crafted or used</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_cf51af02d7363d67" />
            <span class="role-challenge-text">Don't kill an animal for 12 game hours</span>
          </label></div>

        <div class="role-challenge" data-difficulty="easy">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_284a4be7f5835d48" />
            <span class="role-challenge-text">1 Legendary Animals photographed</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_c3e539a86cd5b9ff" />
            <span class="role-challenge-text">5 Crafted or cooked at Wilderness Camp</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_221236541d4abf9a" />
            <span class="role-challenge-text">1 Hardy Tonics used when too hot or cold</span>
          </label></div>

        <div class="role-challenge" data-difficulty="med">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_284a4be7f5835d48" />
            <span class="role-challenge-text">1 Legendary Animals photographed</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_6cdbce1b8ac129af" />
            <span class="role-challenge-text">2 Blending Tonics crafted or used</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_c36d02f902de2cbc" />
            <span class="role-challenge-text">Don't kill an animal for 24 game hours</span>
          </label></div>

        <div class="role-challenge" data-difficulty="hard">
          <label class="role-challenge-label">
            <input type="checkbox" class="challenge-checkbox" id="role-challenge_2026-01-02_9a50d23e61c79c00" />
            <span class="role-challenge-text">2 Legendary Animals found using pheromones</span>
          </label></div>
</div>

            
            <hr class="api-credit-separator" />
            
            <div class="api-credit">
                <span class="api-label">Data provided by:&nbsp;</span>
                <a href="https://rdo.gg/api" target="_blank" class="api-link">rdo.gg API</a>
            </div>
        </div>

    
<!-- COLUMN 3: BONUS INFO -->
        <div class="bonus-container" id="bonus-container">
            <h3 class="stats-heading" style="color: #666666; margin-bottom: 1px; padding-bottom: 0px;">Bonus Info</h3>
            
<div style="padding: 2px; border: 1px solid #000; border-radius: 8px; background-color: #151515; text-align: left; color: #E0E0E0; font-family: sans-serif;">
                
                <p class="stats-text" id="streak-container" style="margin-bottom: 0px; display: flex; justify-content: space-between; align-items: center; width: 100%;">
                    <span style="display: flex; align-items: center; white-space: nowrap;">
                        <span style="font-weight: 500;">Daily Challenge Streak:</span>
                        <span id="streak-controls">
                            <span id="streak-down">▼</span><span id="streak-up">▲</span>
                        </span>
                    </span>
                    <span id="current-streak" style="color: #FFC107; text-align: right;">0 Days</span>
                </p>

                <p class="stats-text" style="margin-bottom: 0px; display: flex; justify-content: space-between; width: 100%;">
                    <span style="font-weight: 500;">Gold Per Challenge:</span>
                    <span id="gold-per-challenge" style="color: #FFC107; text-align: right;">0.00 Gold Bars</span>
                </p>
                
                <p class="stats-text" style="margin-bottom: 0px; display: flex; justify-content: space-between; width: 100%;">
                    <span style="font-weight: 500;">Completion Reward:</span>
                    <span id="completion-bonus-reward" style="color: #FFC107; text-align: right;">0.00 Gold Bars</span>
                </p>
                
                <p class="stats-text" style="margin-bottom: 0px; display: flex; justify-content: space-between; width: 100%;">
                    <span style="font-weight: 500;">Daily Gold Total:</span>
                    <span id="daily-gold-total" style="color: #FFC107; text-align: right;">0.00 Gold Bars</span>
                </p>
                
                <p class="stats-text" style="margin-bottom: 0px; display: flex; justify-content: space-between; width: 100%;">
                    <span style="font-weight: 500;">Streak Week Gold Total:</span>
                    <span id="cycle-gold-total" style="color: #FFC107; text-align: right;">0.00 Gold Bars</span>
                </p>
                
                <p class="stats-text" style="display: flex; justify-content: space-between; width: 100%;">
                    <span style="font-weight: 500;">Streak Gold Total:</span>
                    <span id="streak-gold-total" style="color: #FFC107; text-align: right;">0.00 Gold Bars</span>
                </p>
                
            </div>
            
            
            <!-- Gold Log Chart Container -->
                
            <h3 class="stats-heading" style="color: #666666; margin-top: 15px; margin-bottom: 1px; padding-bottom: 0px;">Gold Log (Last 28 Days)</h3>

  
             <div id="gold-log-chart-container">
                <!-- Bars will be injected here by JavaScript -->
            </div>
            <div id="chart-info-display" class="chart-info-display">&nbsp;</div>


<!-- NAZAR LOCATION SECTION -->
            <h3 class="stats-heading" style="color: #666666; margin-top: 30px; margin-bottom: 1px; padding-bottom: 0px;">Where Is Madam Nazar Today?</h3>            
            <div style="padding: 2px; border: 1px solid #000; border-radius: 8px; background-color: #151515; text-align: center;">
                <div style="color: #FFC107; font-family: 'RDOFont', sans-serif; font-size: 1.4rem; letter-spacing: 0.05em; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); margin-bottom: 2px; line-height: 1.1;">
                    Twin Rocks
                </div>
                
                <!-- Image with toggle logic -->
                <img src="HTML/images/nazar/RDO_Nazar___p_1_new_austin___p_4_twin_rocks.png" 
                     id="nazar-map-img"
                     alt="Nazar Location Map" 
                     data-standard="HTML/images/nazar/RDO_Nazar___p_1_new_austin___p_4_twin_rocks.png"
                     data-zoom="HTML/images/nazar/RDO_Nazar___p_1_new_austin___p_4_twin_rocks___zoom.png"
                     data-has-zoom="true"
                     onclick="toggleNazarZoom(this)"
                     style="width: 100%; height: auto; border-radius: 4px; border: 1px solid #333; display: block; cursor: pointer; transition: transform 0.1s;" 
                />
                
                <!-- Tiny hint text if zoom exists -->
                <div style="font-size: 0.7rem; color: #777; margin-top: 1px; display: block;">
                    (Click map to zoom)
                </div>
            </div>
            
            
<!-- UPCOMING EVENTS SECTION (NEW) -->
            <h3 class="stats-heading" style="color: #666666; margin-top: 20px; margin-bottom: 1px; padding-bottom: 0px;">Upcoming Events</h3>
            <div style="padding: 2px; border: 1px solid #000; border-radius: 8px; background-color: #151515; min-height: 85px;">
                <div id="upcoming-events-list">
                    <div style="text-align:center; padding:10px; color:#555; font-size:0.8rem;">Loading Events...</div>
                </div>
            </div>
            
            
            
            
            
            

  
  
  
<!-- Default Statcounter code for RDO_dailies - codedunky
https://codedunky.github.io/RDO_dailies/ -->
<script type="text/javascript">
var sc_project=13147326; 
var sc_invisible=1; 
var sc_security="51162dbd"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/13147326/0/51162dbd/1/"
alt="Web Analytics"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
<!-- End of Statcounter Code -->  
  
  









<script>
// ////////////////////////////////////////////////////////////////////////////////////// //
// JavaScript: Check if flask server is running and show or hide button accordingly       //
// ////////////////////////////////////////////////////////////////////////////////////// //

fetch('http://127.0.0.1:6969/status')
    .then(response => {
      if (response.ok) {
        document.getElementById('pauseBtn').style.display = 'inline';
      } else {
        document.getElementById('pauseBtn').style.display = 'none';
      }
    })
    .catch(error => {
      document.getElementById('pauseBtn').style.display = 'none';
    });

// ////////////////////////////////////////////////////////////////////////////////////// //
// JavaScript: Banner and Clock Logic                                                     //
// ////////////////////////////////////////////////////////////////////////////////////// //

function resizeBannerText() {
    const container = document.querySelector('.banner-container');
    const title = document.querySelector('.banner-title');
    const date = document.querySelector('.banner-date');
    const counters = document.querySelector('.challenge-counters');
    const clock = document.getElementById('rdo-clock');

    if (!container) return;

    const containerWidth = container.offsetWidth;
    const minWidth = 400;
    const maxWidth = 850;
    const scale = Math.max(minWidth, Math.min(containerWidth, maxWidth)) / maxWidth;

    title.style.fontSize = (2.5 * scale) + 'rem';
    date.style.fontSize = (1.4 * scale) + 'rem';
    counters.style.fontSize = (1.25 * scale) + 'rem';
    
    if (clock) {
        clock.style.fontSize = (2 * scale) + 'rem';
    }
}

window.addEventListener('resize', resizeBannerText);
window.addEventListener('load', resizeBannerText);

const offsetSeconds = -600; // -10 minutes offset for game clock

function getInGameHour() {
    const now = new Date();
    const utcSeconds = now.getUTCHours() * 3600 + now.getUTCMinutes() * 60 + now.getUTCSeconds();
    const gameSeconds = (utcSeconds * 30 + offsetSeconds) % 86400;
    return Math.floor(gameSeconds / 3600) + Math.floor((gameSeconds % 3600) / 60) / 60;
}

function updateAllTimeFunctions() {
    const hourFloat = getInGameHour();
    const gameHours = Math.floor(hourFloat).toString().padStart(2, '0');
    const gameMinutes = Math.floor((hourFloat % 1) * 60).toString().padStart(2, '0');
    document.getElementById("rdo-clock").textContent = `${gameHours}:${gameMinutes}`;

    const banner = document.querySelector('.banner-image');
    const clock = document.querySelector('.rdo-clock');
    
    if (hourFloat >= 22 || hourFloat < 5) {
        if (!banner.src.endsWith("RDO_Banner_Wide_Night.jpg")) banner.src = "HTML/images/RDO_Banner_Wide_Night.jpg";
        clock.classList.add('night-glow');
    } else {
        if (!banner.src.endsWith("RDO_Banner_Wide.jpg")) banner.src = "HTML/images/RDO_Banner_Wide.jpg";
        clock.classList.remove('night-glow');
    }
}

setInterval(updateAllTimeFunctions, 1000);
updateAllTimeFunctions();


// ////////////////////////////////////////////////////////////////////////////////////// //
// Toggle Nazar Map Zoom                                                                  //
// ////////////////////////////////////////////////////////////////////////////////////// //

    function toggleNazarZoom(img) {
        if (img.dataset.hasZoom !== "true") return;

        // Check if currently showing the standard image
        // We compare the end of the string to avoid absolute/relative path mismatches
        const currentSrc = img.src.split('/').pop();
        const stdSrc = img.dataset.standard.split('/').pop();

        if (currentSrc === stdSrc) {
            // Switch to Zoom
            img.src = img.dataset.zoom;
        } else {
            // Switch back to Standard
            img.src = img.dataset.standard;
        }
    }
    // Expose to window so onclick can find it
    window.toggleNazarZoom = toggleNazarZoom;






// ////////////////////////////////////////////////////////////////////////////////////// //
// JavaScript: Main Logic                                                                 //
// ////////////////////////////////////////////////////////////////////////////////////// //

document.addEventListener("DOMContentLoaded", function() {

    // --- CONSTANTS INJECTED FROM PYTHON ---
    const PYTHON_STREAK_OVERRIDE = -1;
    const PYTHON_CHALLENGE_TIMESTAMP = 1767333600; 
    const PYTHON_ENABLE_DEBUG = true;

    // --- LOCAL STORAGE KEYS ---
    const LS_STREAK_COUNT = 'rdoStreakCount';
    const LS_LAST_COMPLETION_DATE = 'rdoLastCompletionDate';
    const LS_CHALLENGE_STATUS = 'rdoChallengeStatus';
    const LS_STREAK_FOR_MULTIPLIER = 'rdoStreakForMultiplier'; 
    const MAX_RDO_STREAK = 28;
    const LS_GOLD_LOG = 'rdoGoldLog';
    const LS_LAST_KNOWN_TIMESTAMP = 'rdoLastKnownTimestamp';
    
    // --- ELEMENT SELECTORS ---
    const allCheckboxes = document.querySelectorAll('.challenge-checkbox');
    const generalCheckboxes = document.querySelectorAll('.challenge-checkbox[id^="challenge_"]');
    const roleCheckboxes = document.querySelectorAll('.challenge-checkbox[id^="role-challenge_"]');
    
    // --- UTILITY FUNCTIONS ---
    
    function getRDODayKey() {
        const now = new Date();
        const resetTimeHours = 6; 
        const date = new Date(now.getTime());
        if (date.getUTCHours() < resetTimeHours) {
            date.setUTCDate(date.getUTCDate() - 1);
        }
        return date.toISOString().split('T')[0];
    }

    function getChallengeDateKey() {
        const date = new Date(PYTHON_CHALLENGE_TIMESTAMP * 1000);
        return date.toISOString().split('T')[0];
    }

    function getDateDifferenceInDays(dateStr1, dateStr2) {
        const date1 = new Date(`${dateStr1}T12:00:00Z`);
        const date2 = new Date(`${dateStr2}T12:00:00Z`);
        return Math.round(Math.abs(date2 - date1) / (1000 * 60 * 60 * 24));
    }
    
    function setStreakCount(newCount, setCompleted) {
        const count = Math.min(Math.max(0, newCount), MAX_RDO_STREAK); 
        localStorage.setItem(LS_STREAK_COUNT, count);
        if (setCompleted) {
            localStorage.setItem(LS_LAST_COMPLETION_DATE, getRDODayKey());
            localStorage.setItem(LS_CHALLENGE_STATUS, 'completed');
        } else {
            localStorage.removeItem(LS_LAST_COMPLETION_DATE);
            localStorage.removeItem(LS_CHALLENGE_STATUS);
        }
    }

    function getMultiplier() { 
        // FIX: Use LS_STREAK_COUNT (current status) instead of LS_STREAK_FOR_MULTIPLIER (start of day baseline)
        // This ensures the multiplier updates immediately visually when the streak increments (e.g. 7 -> 8).
        const currentStreak = parseInt(localStorage.getItem(LS_STREAK_COUNT) || '0', 10);
        
        if (currentStreak >= 22) return 2.5; // Days 22-28
        if (currentStreak >= 15) return 2.0; // Days 15-21
        if (currentStreak >= 8) return 1.5;  // Days 8-14
        return 1.0;                         // Days 1-7
    }

    function formatGoldForDisplay(goldValue) {
        const fixedValue = goldValue.toFixed(2);
        const parts = fixedValue.split('.');
        return `<span>${parts[0]}</span><span class="gold-decimal">.${parts[1]}</span> Gold Bars`;
    }

    // --- DEBUGGING FUNCTION ---
    function debugGoldStats(daily, week, running, goldLog) {
        if (!PYTHON_ENABLE_DEBUG) return;

        console.group(`%cRDO GOLD STATS`, 'color: #000; background: #FFC107; padding: 4px; border-radius: 4px; font-weight: bold;');
        
        console.table({
            "Current Streak (Live)": localStorage.getItem(LS_STREAK_COUNT) + " Days",
            "Multiplier Lock (Base)": localStorage.getItem(LS_STREAK_FOR_MULTIPLIER) + " Days",
            "Multiplier Value": getMultiplier() + "x",
            "Daily Total": daily.toFixed(2),
            "Streak Week Total": week.toFixed(2),
            "Streak Running Total": running.toFixed(2)
        });

        console.groupCollapsed("Full Gold Log History");
        console.table(goldLog);
        console.groupEnd();
        
        console.groupEnd();
    }

    function calculateDailyGoldTotal(completedGeneral, completedRole) {
        const BASE_REWARD = 0.10; 
        const COMPLETION_BONUS_BASE = 0.30; 
        const multiplier = getMultiplier();
        const completionBonusAmount = COMPLETION_BONUS_BASE * multiplier;
        const generalGold = (completedGeneral * BASE_REWARD) * multiplier;
        const generalBonus = (completedGeneral === 7) ? completionBonusAmount : 0;
        const roleGold = (completedRole * BASE_REWARD) * multiplier;
        const roleBonus = (completedRole === 9) ? completionBonusAmount : 0;
        
        document.getElementById('gold-per-challenge').innerHTML = formatGoldForDisplay(BASE_REWARD * multiplier);
        document.getElementById('completion-bonus-reward').innerHTML = formatGoldForDisplay(completionBonusAmount);
        
        return Math.round((generalGold + generalBonus + roleGold + roleBonus) * 100) / 100;
    }

    function logDailyGold(goldAmount, streakCount, generalCount, roleCount) {
        const today = getRDODayKey();
        if (getChallengeDateKey() !== today) return;

        let goldLog = JSON.parse(localStorage.getItem(LS_GOLD_LOG)) || [];
        const todayEntryIndex = goldLog.findIndex(entry => entry.date === today);
        const newEntry = { date: today, gold: goldAmount, streak: streakCount, general: generalCount, role: roleCount };

        if (todayEntryIndex > -1) {
            goldLog[todayEntryIndex] = newEntry;
        } else {
            goldLog.push(newEntry);
        }
        while (goldLog.length > 28) goldLog.shift();
        localStorage.setItem(LS_GOLD_LOG, JSON.stringify(goldLog));
    }
    
    
    // --- EVENTS DATA FROM PYTHON ---
    const RAW_EVENTS_DATA = [{"time": "00:00", "name": "Cold Dead Hands", "cat": "standard"}, {"time": "00:45", "name": "Railroad Baron", "cat": "standard"}, {"time": "01:30", "name": "Wild Animal Kills Challenge", "cat": "standard"}, {"time": "02:15", "name": "Fools Gold", "cat": "standard"}, {"time": "03:00", "name": "Challenges", "cat": "standard"}, {"time": "03:45", "name": "Wildlife Photographer", "cat": "standard"}, {"time": "04:30", "name": "King of the Castle", "cat": "standard"}, {"time": "05:15", "name": "Fishing Swamp Challenge", "cat": "standard"}, {"time": "06:00", "name": "Dispatch Rider", "cat": "standard"}, {"time": "06:45", "name": "Challenges", "cat": "standard"}, {"time": "07:30", "name": "Wildlife Photographer", "cat": "standard"}, {"time": "08:15", "name": "Railroad Baron", "cat": "standard"}, {"time": "09:00", "name": "Master Archer", "cat": "standard"}, {"time": "09:45", "name": "Wildlife Photographer", "cat": "standard"}, {"time": "10:30", "name": "Fishing Lake Challenge", "cat": "standard"}, {"time": "11:15", "name": "King of the Castle", "cat": "standard"}, {"time": "12:00", "name": "Cold Dead Hands", "cat": "standard"}, {"time": "12:45", "name": "Railroad Baron", "cat": "standard"}, {"time": "13:30", "name": "Wild Animal Kills Challenge", "cat": "standard"}, {"time": "14:15", "name": "Fools Gold", "cat": "standard"}, {"time": "15:00", "name": "Challenges", "cat": "standard"}, {"time": "15:45", "name": "Wildlife Photographer", "cat": "standard"}, {"time": "16:30", "name": "King of the Castle", "cat": "standard"}, {"time": "17:15", "name": "Fishing Swamp Challenge", "cat": "standard"}, {"time": "18:00", "name": "Dispatch Rider", "cat": "standard"}, {"time": "18:45", "name": "Challenges", "cat": "standard"}, {"time": "19:30", "name": "Wildlife Photographer", "cat": "standard"}, {"time": "20:15", "name": "Railroad Baron", "cat": "standard"}, {"time": "21:00", "name": "Master Archer", "cat": "standard"}, {"time": "21:45", "name": "Wildlife Photographer", "cat": "standard"}, {"time": "22:30", "name": "Fishing Lake Challenge", "cat": "standard"}, {"time": "23:15", "name": "King of the Castle", "cat": "standard"}, {"time": "00:22", "name": "Protect Legendary Animal", "cat": "themed"}, {"time": "01:52", "name": "Day Of Reckoning", "cat": "themed"}, {"time": "03:22", "name": "Animal Tagging", "cat": "themed"}, {"time": "04:52", "name": "Manhunt", "cat": "themed"}, {"time": "06:22", "name": "Trade Route", "cat": "themed"}, {"time": "07:52", "name": "Condor Egg", "cat": "themed"}, {"time": "09:22", "name": "Day Of Reckoning", "cat": "themed"}, {"time": "10:52", "name": "Protect Legendary Animal", "cat": "themed"}, {"time": "12:22", "name": "Manhunt", "cat": "themed"}, {"time": "13:52", "name": "Salvage", "cat": "themed"}, {"time": "15:22", "name": "Day Of Reckoning", "cat": "themed"}, {"time": "16:52", "name": "Animal Tagging", "cat": "themed"}, {"time": "18:22", "name": "Manhunt", "cat": "themed"}, {"time": "19:52", "name": "Trade Route", "cat": "themed"}, {"time": "21:22", "name": "Condor Egg", "cat": "themed"}, {"time": "22:52", "name": "Day Of Reckoning", "cat": "themed"}]; 

    // ////////////////////////////////////////////////////////////////////////////////////// //
    // JavaScript: Dynamic Upcoming Events Logic                                              //
    // ////////////////////////////////////////////////////////////////////////////////////// //

function updateUpcomingEvents() {
        const container = document.getElementById('upcoming-events-list');
        if (!container || !RAW_EVENTS_DATA.length) return;

        const now = new Date();
        const JOIN_WINDOW_MS = 3 * 60 * 1000; // 3 minutes

        let candidates = [];
        
        function getEventDate(timeStr, dayOffset) {
            const [h, m] = timeStr.split(':').map(Number);
            const d = new Date();
            d.setUTCHours(h, m, 0, 0);
            if (dayOffset > 0) {
                d.setUTCDate(d.getUTCDate() + dayOffset);
            }
            return d;
        }

        RAW_EVENTS_DATA.forEach(evt => {
            const t1 = getEventDate(evt.time, 0);
            candidates.push({ ...evt, dt: t1 });
            const t2 = getEventDate(evt.time, 1);
            candidates.push({ ...evt, dt: t2 });
        });

        const activeEvents = candidates.filter(e => {
            return (e.dt.getTime() + JOIN_WINDOW_MS) > now.getTime();
        });

        activeEvents.sort((a, b) => a.dt - b.dt);
        const next5 = activeEvents.slice(0, 5);

        let html = '<ul style="list-style: none; padding: 0; margin: 0;">';
        
        next5.forEach(e => {
            const diffMs = e.dt - now; 
            
            let timeDisplay = "";
            let rowBgColor = "transparent"; 
            let rowPadding = "1px 0"; 
            let textColor = "#ccc";
            let timeColor = "#bbb";   
            let textClass = "";
            
            // Define truncation limit (Default: 25 chars)
            let maxNameLength = 27; 

            if (diffMs > 0) {
                // === FUTURE EVENT ===
                const diffMins = Math.floor(diffMs / 60000);
                if (diffMins < 60) {
                    timeDisplay = `${diffMins}m`;
                } else {
                    const h = Math.floor(diffMins / 60);
                    const m = diffMins % 60;
                    timeDisplay = `${h}h ${m}m`;
                }
            } else {
                // === ACTIVE / STARTED EVENT ===
                textClass = "active-event-glow";
                
                // NEW: Reduce name length to make room for "Join Now" text
                maxNameLength = 27; 
                
                const msPast = Math.abs(diffMs);
                rowPadding = "2px 4px"; 
                textColor = "#fff"; 
                timeColor = "#ddd"; 

                if (msPast < 60000) {
                    rowBgColor = "#333333";
                    timeDisplay = "Now";
                } else if (msPast < 120000) {
                    rowBgColor = "#555500"; 
                    timeDisplay = "Now";
                } else {
                    rowBgColor = "#550000";
                    timeDisplay = "<1min";
                }
            }
            
            // Apply Dynamic Truncation
            let nameDisplay = e.name;
            if (nameDisplay.length > maxNameLength) {
                nameDisplay = nameDisplay.substring(0, maxNameLength - 2) + "..";
            }
            
            const eventTimeStr = e.time; 

            html += `
            <li style="display: flex; justify-content: space-between; align-items: center; padding: ${rowPadding}; border-bottom: 1px solid #1a1a1a; font-size: 0.85rem; color: ${textColor}; background-color: ${rowBgColor}; border-radius: 2px; margin-bottom: 1px; transition: background-color 0.5s;">
                <div style="line-height: 1;">
                    <span class="${textClass}" style="font-family: 'hapna', sans-serif; letter-spacing: -0.05em;">${nameDisplay}</span>
                    <span style="font-size: 0.7rem; color: ${timeColor}; margin-left: 4px; letter-spacing: -0.05em;">(${timeDisplay})</span>
                </div>
                <span class="${textClass}" style="color: #FFC107; font-family: 'RDOFont', sans-serif; font-size: 1.0rem; letter-spacing: 1px; line-height: 1;">${eventTimeStr}</span>
            </li>
            `;
        });
        
        html += '</ul>';
        container.innerHTML = html;
    }
    
    
    
    
    
    // Run immediately, then every second to keep "minutes remaining" accurate
    setInterval(updateUpcomingEvents, 1000);
    // Also run on load
    window.addEventListener('load', updateUpcomingEvents);
    
    
    
    
// UPDATED FUNCTION: Fixed calculation to prevent summing previous cycle's weeks
    function calculateLogSums(currentStreak) {
        const goldLog = JSON.parse(localStorage.getItem(LS_GOLD_LOG)) || [];
        
        // 1. Determine the minimum streak day for the current week bracket
        let minWeekStreak = 1;
        if (currentStreak >= 22) minWeekStreak = 22;
        else if (currentStreak >= 15) minWeekStreak = 15;
        else if (currentStreak >= 8) minWeekStreak = 8;
        
        let weekTotal = 0.0;
        let runningTotal = 0.0;
        
        // Track the streak number of the previous iteration (initially -1)
        let lastStreakVal = -1;
        
        // Loop BACKWARDS through the log (newest to oldest)
        for (let i = goldLog.length - 1; i >= 0; i--) {
            const entry = goldLog[i];
            const val = parseFloat(entry.gold || 0);
            const s = parseInt(entry.streak || 0);
            
            // If we hit a 0 streak or data is missing, stop calculations
            if (s === 0) break;
            
            // CYCLE BOUNDARY CHECK:
            // If the streak number jumps UP while going backwards (e.g., 1 -> 28),
            // we have crossed into the previous 28-day cycle. Stop the running total.
            if (lastStreakVal !== -1 && s > lastStreakVal) {
                break;
            }

            // Add to Running Total (Streak Gold Total)
            runningTotal += val;

            // WEEK TOTAL CHECK:
            // Only add to the week total if the streak is within the current bracket.
            // Since we break the loop above if we cross a cycle boundary, 
            // this simply filters out days 1-21 if we are in week 4 (22-28).
            if (s >= minWeekStreak) {
                weekTotal += val;
            }

            lastStreakVal = s;
        }
        
        return { week: weekTotal, running: runningTotal };
    }
    
    function renderGoldLogChart() {
        const GOLD_CHART_MULTIPLIER = 12; 
        const container = document.getElementById('gold-log-chart-container');
        const infoDisplay = document.getElementById('chart-info-display');
        if (!container || !infoDisplay) return;

        // Audio Context Setup
        if (!window.rdoAudioCtx) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            window.rdoAudioCtx = new AudioContext();
            const unlockAudio = () => {
                if (window.rdoAudioCtx.state === 'suspended') window.rdoAudioCtx.resume();
                document.removeEventListener('click', unlockAudio);
            };
            document.addEventListener('click', unlockAudio);
        }
        
        function playHoverTick() {
            const ctx = window.rdoAudioCtx;
            if (!ctx || ctx.state === 'suspended') return;
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'triangle'; 
            osc.frequency.setValueAtTime(1200, ctx.currentTime);
            gain.gain.setValueAtTime(0.2, ctx.currentTime); 
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
            osc.start();
            osc.stop(ctx.currentTime + 0.05);
        }

        infoDisplay.innerHTML = '&nbsp;';
        const goldLog = JSON.parse(localStorage.getItem(LS_GOLD_LOG)) || [];
        container.innerHTML = '';

        if (goldLog.length === 0) {
            container.innerHTML = '<p style="color: #666; font-size: 0.8rem; text-align: center; width: 100%;">No gold data logged yet.</p>';
            return;
        }

        function getBarColorForStreak(streak) {
            if (!streak) return '#555555';
            if (streak >= 22) return '#FFD200'; 
            if (streak >= 15) return '#E4B800'; 
            if (streak >= 8)  return '#C59A00'; 
            return '#A57C00';                   
        }
        
        const availableWidth = container.clientWidth - 4; 
        const barWidth = Math.max(Math.floor(availableWidth / 28) - 2, 2);
        let tooltipLeaveTimer;

        goldLog.forEach(entry => {
            const barHeight = Math.max((entry.gold * GOLD_CHART_MULTIPLIER), 0);
            const wrapper = document.createElement('div');
            wrapper.className = 'chart-bar-wrapper';
            wrapper.style.width = `${barWidth}px`;
            
            const bar = document.createElement('div');
            bar.className = 'chart-bar';
            bar.style.height = `${barHeight}px`;
            bar.style.backgroundColor = getBarColorForStreak(entry.streak);

            wrapper.appendChild(bar);
            container.appendChild(wrapper);

            const date = new Date(entry.date); 

            wrapper.addEventListener('mouseenter', () => {
                if (tooltipLeaveTimer) clearTimeout(tooltipLeaveTimer);
                bar.style.backgroundColor = '#FFFFFF';
                bar.style.boxShadow = '0 0 8px rgba(255, 255, 255, 0.9)';
                playHoverTick();

                const humanDate = date.toLocaleDateString('en-GB', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' });
                const streakText = entry.streak ? `Day ${entry.streak} (Week ${Math.floor((entry.streak - 1) / 7) + 1})` : 'No Streak';
                
                let star = '';
                if (entry.general === 7 && entry.role === 9) {
                    star = ' <span style="color: #FFD700;">⭐</span>';
                } else if (entry.general === 7 || entry.role === 9) {
                    star = ' <span style="filter: grayscale(100%) brightness(1.3);">⭐</span>';
                }
                
                infoDisplay.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: baseline; width: 100%; font-size: 0.9rem;">
                        <span style="font-weight: bold;">${humanDate}</span>
                        <span>${entry.gold.toFixed(2)} Gold${star}</span>
                    </div>
                    <div style="font-size: 0.8rem; color: #999;">Streak: ${streakText} | Gen: ${entry.general}/7, Role: ${entry.role}/9</div>
                `;
                infoDisplay.style.color = '#aaa';
            });

            wrapper.addEventListener('mouseleave', () => {
                bar.style.backgroundColor = getBarColorForStreak(entry.streak);
                bar.style.boxShadow = 'none';
                tooltipLeaveTimer = setTimeout(() => {
                    infoDisplay.innerHTML = '&nbsp;';
                }, 200);
            });
        });
    }

    // --- CORE UPDATE LOGIC ---
    
    function loadStreak() {
        let currentStreak = parseInt(localStorage.getItem(LS_STREAK_COUNT) || '0', 10);
        if (PYTHON_STREAK_OVERRIDE > -1) {
            currentStreak = PYTHON_STREAK_OVERRIDE; 
            setStreakCount(currentStreak, true);
        }
        
        const lastCompletionDateStr = localStorage.getItem(LS_LAST_COMPLETION_DATE);
        if (lastCompletionDateStr) {
            const diff = getDateDifferenceInDays(getRDODayKey(), lastCompletionDateStr);
            if (diff > 1 || (diff === 1 && currentStreak >= MAX_RDO_STREAK)) {
                currentStreak = 0;
                setStreakCount(0, false);
            }
            if (diff >= 1) {
                localStorage.removeItem(LS_CHALLENGE_STATUS);
                localStorage.removeItem(LS_LAST_COMPLETION_DATE); 
            }
        }
        
        localStorage.setItem(LS_STREAK_FOR_MULTIPLIER, currentStreak);
        document.getElementById('current-streak').textContent = `${currentStreak} Days`;
    }

    function updateCounters() {
        const generalDone = Array.from(generalCheckboxes).filter(cb => cb.checked).length;
        const roleDone = Math.min(
            Array.from(roleCheckboxes).filter(cb => cb.checked && cb.closest('.role-challenge')?.style.display !== 'none').length,
            9
        );

        document.getElementById('general-counter').textContent = `${generalDone}/7`;
        document.getElementById('general-counter').classList.toggle('counter-glow', generalDone === 7);
        document.getElementById('role-counter').textContent = `${roleDone}/9`;
        document.getElementById('role-counter').classList.toggle('counter-glow', roleDone === 9);
        
        const dailyGoldTotal = calculateDailyGoldTotal(generalDone, roleDone);
        const currentStreak = parseInt(localStorage.getItem(LS_STREAK_COUNT) || '0', 10);
        
        document.getElementById('current-streak').textContent = `${currentStreak} Days`; 
        
        const goldDisplay = document.getElementById('daily-gold-total');
        const isDataCurrent = (getChallengeDateKey() === getRDODayKey());
        
        if (isDataCurrent) {
            // 1. Log today's calculated gold (and streak) to localStorage
            logDailyGold(dailyGoldTotal, currentStreak, generalDone, roleDone);
            goldDisplay.innerHTML = formatGoldForDisplay(dailyGoldTotal);
        } else {
            goldDisplay.innerHTML = '<span style="color: #888; font-size: 0.8em;">PREVIOUS DAY DATA</span>';
        }

        // 2. Calculate Week/Running totals by summing the Log
        const sums = calculateLogSums(currentStreak);
        
        // 3. Update DOM with flash effect if values changed
        const newCycleHTML = formatGoldForDisplay(sums.week);
        const cycleEl = document.getElementById('cycle-gold-total');
        if (cycleEl.innerHTML !== newCycleHTML) {
             cycleEl.innerHTML = newCycleHTML;
             cycleEl.classList.remove('gold-exciting-flash');
             void cycleEl.offsetWidth; 
             cycleEl.classList.add('gold-exciting-flash');
             setTimeout(() => cycleEl.classList.remove('gold-exciting-flash'), 1000);
        }
        
        const newStreakHTML = formatGoldForDisplay(sums.running);
        const streakEl = document.getElementById('streak-gold-total');
        if (streakEl.innerHTML !== newStreakHTML) {
             streakEl.innerHTML = newStreakHTML;
             streakEl.classList.remove('gold-exciting-flash');
             void streakEl.offsetWidth; 
             streakEl.classList.add('gold-exciting-flash');
             setTimeout(() => streakEl.classList.remove('gold-exciting-flash'), 1000);
        }

        const rolesContainer = document.getElementById('roles-container') || document.body;
        rolesContainer.classList.toggle('all-roles-completed', roleDone === 9);
        document.querySelectorAll('.difficulty-toggle').forEach(toggle => toggle.classList.toggle('dimmed-text', roleDone === 9));
        
        document.querySelectorAll('.role-container').forEach(roleContainer => {
            const visible = Array.from(roleContainer.querySelectorAll('.role-challenge')).filter(ch => ch.style.display !== 'none');
            const allComp = visible.length > 0 && visible.every(ch => ch.querySelector('.challenge-checkbox')?.checked);
            roleContainer.querySelector('.role-heading')?.classList.toggle('dimmed', allComp);
        });
        
        renderGoldLogChart();
        // --- DEBUG LOG ---
        const goldLog = JSON.parse(localStorage.getItem(LS_GOLD_LOG)) || [];
        debugGoldStats(dailyGoldTotal, sums.week, sums.running, goldLog);
    }
    
    function handleStreakUpdate(isTicked) {
        const checkedCount = Array.from(allCheckboxes).filter(cb => cb.checked).length;
        const currentStatus = localStorage.getItem(LS_CHALLENGE_STATUS);
        const lockedStreak = parseInt(localStorage.getItem(LS_STREAK_FOR_MULTIPLIER) || '0', 10);
        
        if (isTicked && checkedCount > 0 && currentStatus !== 'completed') {
            const newStreak = lockedStreak + 1;
            setStreakCount(newStreak, true);
        } else if (!isTicked && checkedCount === 0 && currentStatus === 'completed') {
            setStreakCount(lockedStreak, false);
        }
        updateCounters();
    }

    // --- INIT ---
    
    const dailyKeyCheck = localStorage.getItem(LS_LAST_KNOWN_TIMESTAMP);
    if (dailyKeyCheck != PYTHON_CHALLENGE_TIMESTAMP) {
        Object.keys(localStorage).forEach(k => { if(k.includes('_challenge_')) localStorage.removeItem(k); });
    }
    
    localStorage.setItem(LS_LAST_KNOWN_TIMESTAMP, PYTHON_CHALLENGE_TIMESTAMP);
    
    allCheckboxes.forEach(cb => {
        const key = `${PYTHON_CHALLENGE_TIMESTAMP}_${cb.id}`;
        cb.checked = localStorage.getItem(key) === "true";
        if(cb.checked) cb.closest('div').classList.add('completed');
        
        cb.addEventListener('change', () => {
            cb.closest('div').classList.toggle('completed', cb.checked);
            localStorage.setItem(key, cb.checked);
            handleStreakUpdate(cb.checked);
        });
    });

    document.getElementById('streak-up').addEventListener('click', () => { 
        localStorage.setItem(LS_STREAK_COUNT, Math.min(28, parseInt(localStorage.getItem(LS_STREAK_COUNT)||0)+1)); 
        localStorage.setItem(LS_STREAK_FOR_MULTIPLIER, localStorage.getItem(LS_STREAK_COUNT));
        updateCounters(); 
    });
    document.getElementById('streak-down').addEventListener('click', () => { 
        localStorage.setItem(LS_STREAK_COUNT, Math.max(0, parseInt(localStorage.getItem(LS_STREAK_COUNT)||0)-1)); 
        localStorage.setItem(LS_STREAK_FOR_MULTIPLIER, localStorage.getItem(LS_STREAK_COUNT));
        updateCounters(); 
    });

    document.querySelectorAll('.difficulty-toggle').forEach(toggle => {
        const roleContainer = toggle.closest('.role-container');
        const roleName = roleContainer.querySelector('.role-heading').textContent.split('(')[0].trim().toLowerCase().replace(/[^a-z0-9]/g, '');
        const lsKey = `difficulty_${roleName}`;
        
        function setView(diff) {
            roleContainer.querySelectorAll('.role-challenge').forEach(ch => ch.style.display = (ch.dataset.difficulty === diff) ? '' : 'none');
            toggle.dataset.difficulty = diff;
            const desc = diff === 'easy' ? 'Rank 1–5' : diff === 'med' ? 'Rank 6–14' : 'Rank 15+';
            toggle.textContent = `(${diff.charAt(0).toUpperCase() + diff.slice(1)}: ${desc})`;
        }
        
        setView(localStorage.getItem(lsKey) || 'hard');
        
        toggle.addEventListener('click', () => {
            if (toggle.classList.contains('dimmed-text')) return;
            const next = toggle.dataset.difficulty === 'easy' ? 'med' : toggle.dataset.difficulty === 'med' ? 'hard' : 'easy';
            localStorage.setItem(lsKey, next);
            setView(next);
            roleContainer.querySelectorAll('.role-challenge[style*="display: none"] .challenge-checkbox:checked').forEach(cb => {
                cb.checked = false;
                localStorage.setItem(`${PYTHON_CHALLENGE_TIMESTAMP}_${cb.id}`, false);
            });
            handleStreakUpdate(false);
        });
    });

    loadStreak();
    updateCounters();
    
    window.addEventListener('load', renderGoldLogChart);
    window.addEventListener('resize', renderGoldLogChart);
});

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('pauseBtn').addEventListener('click', () => {
      fetch('http://127.0.0.1:6969/pause', { method: 'POST' })
      .then(r => r.text()).then(d => alert(d)).catch(e => alert(e));
    });
});
</script>











  
</body>
</html>
